'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.plugin = exports.eventType = undefined;

var _flat = require('flat');

var _flat2 = _interopRequireDefault(_flat);

var _constants = require('../util/constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var type = 'alexaSkill';

function eventType() {
  var _ref, _ref2, _ref3, _ref4;

  var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  return ((_ref = e) != null ? (_ref = _ref.session) != null ? _ref.attributes : _ref : _ref) && ((_ref2 = e) != null ? (_ref2 = _ref2.session) != null ? _ref2.user : _ref2 : _ref2) && ((_ref3 = e) != null ? (_ref3 = _ref3.context) != null ? _ref3.System : _ref3 : _ref3) && ((_ref4 = e) != null ? (_ref4 = _ref4.request) != null ? _ref4.requestId : _ref4 : _ref4) ? type : false;
}

var keyBlacklist = ['context.System.apiAccessToken', 'context.System.user.accessToken', 'context.System.user.permissions.consentToken'];

function plugin(event, log) {
  var obj = (0, _flat2.default)(event);
  Object.keys(obj).filter(function (s) {
    return keyBlacklist.indexOf(s) === -1;
  }).forEach(function (key) {
    var val = obj[key];
    if (typeof val !== 'object' || Object.keys(val).length) {
      log(`${_constants.pluginName}.${type}.${key}`, val);
    }
  });
  log(`${_constants.pluginName}.eventType`, type);
}

exports.eventType = eventType;
exports.plugin = plugin;